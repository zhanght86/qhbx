XN.Type.createNamespace("XN");XN._contentSizeMethod=XN.Type.createEnum({oldMthod:0,newOnlyForXnml:1,newMethod:2},false);XN.CanvasClient=XN.Type.createClass({ctor:function(){},static_ctor:function(){XN.CanvasClient.serverReceiverUrl=XNIntern.Utility.getConnectServerUrl("www")+"static/xd_receiver.html?r="+XNIntern.XNGlobals.get_xn_StaticResourceVersions()["www_channel"];XN.CanvasClient.allowWidthChange=false;XN.CanvasClient.__windowSizeChangedCallback=null;XN.CanvasClient._rpcClient=null;XN.CanvasClient._rpcServer=null;XN.CanvasClient._lastSize=XN.$create_Size(-1,-1);XN.CanvasClient._timer=-1;XN.CanvasClient._timerInternal=100;XN.CanvasClient._modifyBodyStyle=true;XN.CanvasClient._urlHandler=XN.CanvasClient.defaultUrlHandler;XN.CanvasClient._allowCallback=null;XN.CanvasClient._cancelCallback=null;XN.CanvasClient._feedCallback=null;XN.CanvasClient._isRenderXnml=false;XN.CanvasClient._allowCallback=function(a){};XN.CanvasClient._cancelCallback=XN.Delegate.Null;XN.CanvasClient._feedCallback=XN.Delegate.Null},statics:{_ensureRpcClient:function(){if(!XN.CanvasClient._rpcClient){XN.CanvasClient._rpcClient=new XN.XdComm.XdRpcClient("iframeOuterServer","iframeInnerClient",new XN.XdComm.EndPoint(null,XN.XdComm.PageRelation.parent,XN.CanvasClient.serverReceiverUrl))}},run:function(){if(!XN.CanvasClient._rpcServer){var b={loadNewUrl:XN.XdComm.$create_XdRpcMethodInfo(XN.CanvasClient.loadNewUrl,null),loginResponse:XN.XdComm.$create_XdRpcMethodInfo(XN.CanvasClient.loginResponse,null),feedResponse:XN.XdComm.$create_XdRpcMethodInfo(XN.CanvasClient.feedResponse,null),sendCheckboxFeed:XN.XdComm.$create_XdRpcMethodInfo(XN.CanvasClient.sendCheckboxFeed,null)};var a="iframeInnerServer";XN.CanvasClient._rpcServer=new XN.XdComm.XdRpcServer(a,b);XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("setInnerReceiver",{receiverUrl:XN.XdComm.Server.singleton.get_receiverUrl()},null)}},get_timerInterval:function(){return XN.CanvasClient._timerInternal},set_timerInterval:function(a){XN.CanvasClient._timerInternal=a;return a},startTimerToSizeToContent:function(){XN.Debug.logLine(4,"CanvasClient: StartTimerToSizeToContent");XN.CanvasClient.setSizeToContent();if(XN.CanvasClient._timer===-1){XN.CanvasClient._timer=window.setInterval(XN.CanvasClient.setSizeToContent,XN.CanvasClient._timerInternal)}},stopTimerToSizeToContent:function(){if(XN.CanvasClient._timer!==-1){window.clearInterval(XN.CanvasClient._timer);XN.CanvasClient._timer=-1}},setSizeToContent:function(){if(XN.CanvasClient.get__isInDialog()){XN.CanvasClient._sizeDialogToContent();return}var a=document.documentElement;if(XN.CanvasClient._modifyBodyStyle){a.style.overflow="hidden"}var b=XN.CanvasClient._computeContentSize();if(XN.CanvasClient.allowWidthChange){if(b.w!==XN.CanvasClient._lastSize.w||b.h!==XN.CanvasClient._lastSize.h){XN.CanvasClient._lastSize=b;XN.CanvasClient._setCanvasSize(b.w.toString()+"px",b.h.toString()+"px",null)}}else{if(b.h!==XN.CanvasClient._lastSize.h){XN.CanvasClient._lastSize=b;XN.CanvasClient.setCanvasHeight(b.h.toString()+"px",null)}}},_sizeDialogToContent:function(){var b=XNIntern.Utility.get_windowSize();var e=XNIntern.Utility.get_documentSize();var c=e.h-b.h;var a=e.w-b.w;if(c||a){XN.Debug.logLine(2,XN.Sys.format("CanvasClient: resize dialog by ({0}, {1})",a,c));try{window.resizeBy(a,c)}catch(d){XN.Debug.logLine(2,XN.Sys.format("CanvasClient: resize faield"))}}},setCanvasHeight:function(a,b){XN.Debug.logLine(2,"CanvasClient: set canvas height to "+a);XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("setCanvasHeight",a,b)},_setCanvasSize:function(b,a,c){XN.Debug.logLine(2,XN.Sys.format("CanvasClient: set canvas size to {0}, {1}",b,a));XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("setCanvasSize",{w:b,h:a},c)},checkboxFeedReady:function(a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("checkboxFeedReady",a,null)},getCanvasInfo:function(a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("getCanvasInfo",null,a)},scrollTo:function(a,c,b){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("scrollTo",XN.$create_Point(a,c),b)},changeUrlSuffix:function(a,b){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("changeUrlSuffix",a,b)},syncUrl:function(){XN.CanvasClient._ensureRpcClient();var a=document.location;XN.CanvasClient._rpcClient.send("refreshUrl",a,null);XN.CanvasClient.run()},requireLogin:function(a,b){XN.CanvasClient._ensureRpcClient();XN.CanvasClient.run();XN.CanvasClient._allowCallback=a;XN.CanvasClient._cancelCallback=b;XN.CanvasClient._rpcClient.send("requireLogin",null,null)},closeLogin:function(){XN.CanvasClient._ensureRpcClient();XN.CanvasClient.run();XN.CanvasClient._rpcClient.send("closeLogin",null,null)},loginResponse:function(a,b){if(a){XN.CanvasClient._allowCallback(a)}else{XN.CanvasClient._cancelCallback()}return null},feedResponse:function(a,b){XN.CanvasClient._feedCallback();return null},formReUrl:function(k){var m="&";var j=k.api_key;var i=k.callback;var g=k.user_message_prompt;var c=k.user_message;var d=k.feed_info;var e=k.preview;var f=k.channel_url;var l=k.size;var h=k.session_key;var a=document.getElementById("time").value;var b=document.getElementById("post_form_id").value;return"api_key="+j+m+"callback="+i+m+"user_message_prompt="+encodeURIComponent(g)+m+"user_message="+encodeURIComponent(c)+m+"feed_info="+encodeURIComponent(d)+m+"preview="+e+m+"channel_url="+encodeURIComponent(f)+m+"size="+l+m+"session_key="+encodeURIComponent(h)+m+"time="+a+m+"post_form_id="+b},sendCheckboxFeed:function(arg,senderEndPoint){XN.Debug.logLine(2,"About to submit to send check box feed");var nesend=document.getElementById("share_box");if(!nesend.checked){XN.CanvasClient.checkboxFeedReady({code:1});return}var request=XNIntern.Utility.createXMLHttpRequest();request.onreadystatechange=function(){if(request.readyState==4){if(request.status==200){var b=request.responseText;var obj=eval("("+b+")");if(obj.code==0){XN.Debug.logLine(1,"Receive succ Message");XN.CanvasClient.checkboxFeedReady({code:0})}else{XN.Debug.logLine(1,"Receive fail Message");XN.CanvasClient.checkboxFeedReady({code:2,errMsg:obj.error})}}else{XN.CanvasClient.checkboxFeedReady({code:2,errMsg:"Http Request Exception code:"+request.status})}}};arg=XN.CanvasClient.formReUrl(arg);url=XNIntern.Utility.getConnectServerUrl("www")+"ceFeed.do";request.open("POST",url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(arg);return null},setUrlHandler:function(a){XN.CanvasClient._urlHandler=a},loadNewUrl:function(a,b){var c=a;XN.Debug.logLine(2,XN.Sys.format("CanvasClient: set internal url to  {0}",c));XN.CanvasClient._urlHandler(c);return null},defaultUrlHandler:function(a){window.location.replace(a)},add_windowSizeChanged:function(b){var a=XN.CanvasClient.__windowSizeChangedCallback;XN.CanvasClient.add__windowSizeChangedCallback(b);if(!a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("attachToWindowResizeEvent",null,XN.CanvasClient._onRpcCompleted)}},remove_windowSizeChanged:function(a){XN.CanvasClient.remove__windowSizeChangedCallback(a)},_onRpcCompleted:function(a){if(XN.CanvasClient.__windowSizeChangedCallback){XN.CanvasClient.__windowSizeChangedCallback(a)}},_computeContentSize:function(){var h=document.body;var d=document.documentElement;var l=0;var a;var g=XN._contentSizeMethod.oldMthod;if(XN.Bootstrap.siteVars&&XN.Sys.containsKey(XN.Bootstrap.siteVars,"canvas_client_compute_content_size_method")){g=XN.Bootstrap.siteVars.canvas_client_compute_content_size_method}if((g===XN._contentSizeMethod.newOnlyForXnml&&XN.CanvasClient._isRenderXnml)||g===XN._contentSizeMethod.newMethod){a=Math.max(Math.max(h.offsetHeight,h.scrollHeight)+h.offsetTop,Math.max(d.offsetHeight,d.scrollHeight)+d.offsetTop)}else{if(XNIntern.AppInfo.get_singleton().get_hostInfo().get_hostName()===XNIntern.HostName.IE){a=Math.max(h.offsetHeight,h.scrollHeight)+h.offsetTop}else{if(XNIntern.AppInfo.get_singleton().get_hostInfo().get_hostName()===XNIntern.HostName.MOZILLA){a=d.offsetHeight+d.offsetTop}else{a=Math.max(d.offsetHeight,d.scrollHeight)+d.offsetTop}}}if(XN.CanvasClient._isRenderXnml){var k=document.getElementById("pop_dialog_table");if(k){var e=Rect.getElementBounds(k).b;a=Math.max(a,e)}}if(XN.CanvasClient.allowWidthChange){if(h.offsetWidth<h.scrollWidth){l=h.scrollWidth+h.offsetLeft}else{var c=h.childNodes;l=0;for(var f=0;f<c.length;f++){var b=c[f];var j=b.offsetWidth+b.offsetLeft;if(j>l){l=j}}}if(d.clientLeft>0){l+=(d.clientLeft*2)}if(d.clientTop>0){a+=(d.clientTop*2)}}return XN.$create_Size(l,a)},get__isInDialog:function(){return window.opener&&window.opener!==window.self},add__windowSizeChangedCallback:function(a){XN.CanvasClient.__windowSizeChangedCallback=XN.Delegate.combine(XN.CanvasClient.__windowSizeChangedCallback,a)},remove__windowSizeChangedCallback:function(a){XN.CanvasClient.__windowSizeChangedCallback=XN.Delegate.remove(XN.CanvasClient.__windowSizeChangedCallback,a)},appBookmark:function(a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("appBookmark",null,a)},showPermissionDialog:function(b,a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("showPermissionDialog",b,a)},showFeedDialog:function(b,a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("showFeedDialog",b,a)},requestPayment:function(b,a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("requestPayment",a,b)},requestPaymentRecords:function(b,a){XN.CanvasClient._ensureRpcClient();XN.CanvasClient._rpcClient.send("requestPaymentRecords",a,b)}}});XN.FeatureLoader.onScriptLoaded(["CanvasUtil"]);